<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Materiales</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module" src="firebase-config.js"></script>
</head>
<body class="modo-oscuro">
  <h1>Lista de Materiales</h1>
  <div id="materiales-container"></div>

  <button class="boton-celeste" onclick="location.href='cargar-materiales.html'">Cargar nuevo material</button>
  <button class="boton-verde" onclick="location.href='config-tareas.html'">Configurar tareas</button>

  <script type="module">
    import { db } from './firebase-config.js';
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const materialesContainer = document.getElementById("materiales-container");

    function agruparPorCategoria(materiales) {
      const grupos = {};
      materiales.forEach((mat) => {
        if (!grupos[mat.categoria]) {
          grupos[mat.categoria] = [];
        }
        grupos[mat.categoria].push(mat);
      });
      return grupos;
    }

    function crearTarjeta(material) {
      return `
        <div class="tarjeta-material">
          <h3>${material.nombre}</h3>
          <p><strong>Precio:</strong> $${material.precioPorUnidad}</p>
          <p><strong>Multiplicador:</strong> ${material.multiplicadorTotal}</p>
          <button class="boton-rojo" onclick="eliminarMaterial('${material.id}')">Eliminar</button>
        </div>
      `;
    }

    function mostrarMaterialesAgrupados(materiales) {
      const grupos = agruparPorCategoria(materiales);
      materialesContainer.innerHTML = '';

      for (const categoria in grupos) {
        const seccion = document.createElement("section");
        seccion.innerHTML = `<h2 class="categoria-titulo">${categoria}</h2>`;
        
        const carrusel = document.createElement("div");
        carrusel.className = "carrusel-materiales";

        grupos[categoria].forEach((mat) => {
          carrusel.innerHTML += crearTarjeta(mat);
        });

        seccion.appendChild(carrusel);
        materialesContainer.appendChild(seccion);
      }
    }

    async function obtenerMateriales() {
      const querySnapshot = await getDocs(collection(db, "materiales"));
      const materiales = querySnapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      mostrarMaterialesAgrupados(materiales);
    }

    window.eliminarMaterial = async function(id) {
      if (confirm("Â¿Eliminar este material?")) {
        const { deleteDoc, doc } = await import("https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js");
        await deleteDoc(doc(db, "materiales", id));
        obtenerMateriales(); // Recarga la lista
      }
    };

    obtenerMateriales();
  </script>
</body>
</html>
